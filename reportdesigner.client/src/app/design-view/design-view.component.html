<div class="design-view-container">
  <div class="formatting-toolbar">
    <div class="button-container">
      <button
        class="material-icons menu-icon icon-bold format-button"
        title="Bold"
        (click)="toggleFormat('bold')"
      >
        format_bold
      </button>
      <button
        class="material-icons menu-icon icon-italic format-button"
        title="Italic"
        (click)="toggleFormat('italic')"
      >
        format_italic
      </button>
      <button
        class="material-icons menu-icon icon-underline format-button"
        title="Underline"
        (click)="toggleFormat('underline')"
      >
        format_underline
      </button>
      <button
        class="material-icons menu-icon icon-strikethrough format-button"
        title="Strike-through"
        (click)="toggleFormat('strikethrough')"
      >
        format_strikethrough
      </button>
      <button
        class="material-icons menu-icon icon-remove-format format-button"
        title="Clear Formatting"
        (click)="removeFormatting()"
      >
        format_clear
      </button>
    </div>

    <div class="font-dropdowns" title="Font Size">
      <select
        class="select-box"
        #fontSizeSelect
        (change)="changeFontSize($any($event.target).value)"
      >
        <option value="10">10px</option>
        <option value="12">12px</option>
        <option value="14">14px</option>
        <option value="16">16px</option>
        <option value="18">18px</option>
        <option value="20">20px</option>
        <option value="24">24px</option>
        <option value="32">32px</option>
        <option value="48">48px</option>
        <option value="56">56px</option>
        <option value="64">64px</option>
        <option value="72">72px</option>
        <option value="84">84px</option>
        <option value="96">96px</option>
        <!-- Add more font sizes as needed -->
      </select>

      <select
        class="select-box"
        title="Font Family"
        #fontFamilySelect
        (change)="changeFontFamily(fontFamilySelect.value)"
      >
        <option value="Arial" style="font-family: Arial">Arial</option>
        <option
          value="'Brush Script MT', cursive"
          style="font-family: Brush Script MT"
        >
          Brush Script MT
        </option>
        <option value="Calibri" style="font-family: Calibri">Calibri</option>
        <option value="Cambria" style="font-family: Cambria">Cambria</option>
        <option value="Comic Sans MS" style="font-family: Comic Sans MS">
          Comic Sans MS
        </option>
        <option value="Courier New" style="font-family: Courier New">
          Courier New
        </option>
        <option value="Franklin Gothic" style="font-family: Franklin Gothic">
          Franklin Gothic
        </option>
        <option value="Garamond" style="font-family: Garamond">Garamond</option>
        <option value="Georgia" style="font-family: Georgia">Georgia</option>
        <option value="Goudy Old Style" style="font-family: Goudy Old Style">
          Goudy Old Style
        </option>
        <option value="Helvetica" style="font-family: Helvetica">
          Helvetica
        </option>
        <option value="Impact" style="font-family: Impact">Impact</option>
        <option
          value="Microsoft Sans Serif"
          style="font-family: Microsoft Sans Serif"
        >
          MS Sans Serif
        </option>
        <option value="Perpetua" style="font-family: Perpetua">Perpetua</option>
        <option value="Rockwell" style="font-family: Rockwell">Rockwell</option>
        <option value="Tahoma" style="font-family: Tahoma">Tahoma</option>
        <option value="Times New Roman" style="font-family: Times New Roman">
          Times New Roman
        </option>
        <option value="Verdana" style="font-family: Verdana">Verdana</option>
        <!-- Add more font families as needed -->
      </select>
    </div>

    <div class="color-container">
      <label for="text-color-input" class="color-label">Text Color:</label>
      <input
        id="text-color-input"
        title="Font Color"
        type="color"
        class="custom-color-input"
        (input)="changeTextColor($any($event.target).value)"
      />

      <label for="background-color-input" class="color-label"
        >Background Color:</label
      >
      <input
        id="background-color-input"
        title="Background Color"
        type="color"
        class="custom-color-input"
        (input)="changeBackgroundColor($any($event.target).value)"
      />
    </div>
    <button
      class="material-icons-outlined reload_btn"
      title="Reload Data"
    >
      change_circle
    </button>
  </div>

  <!-- Start Report Wizard button -->
  <button *ngIf="!showReportWizard && !showReportContainer" class="start-wizard-button" (click)="toggleReportWizard()">Create New Report</button><br>
  <button *ngIf="!showReportWizard && !showReportContainer" class="start-wizard-button" (click)="toggleReportWizard()">Open Existing Report</button>

  <!-- Popup/modal for the report wizard -->
  <div class="report-wizard-popup" *ngIf="showReportWizard && !showReportContainer">
    <div class="popup-content">
      <h2>Report Wizard</h2>
      <label for="reportTitle">Report Title:</label>
      <input type="text" id="reportTitle" [(ngModel)]="reportTitle" /><br><br />

      <!-- Input field for logo selection -->
      <label for="reportLogo">Report Logo:</label>
      <input type="file" id="reportLogo" (change)="onLogoSelected($event)" accept="image/*" /><br><br />
      <!-- Add other input fields for logo selection, database, and table selection -->

      <div class="button-container">
        <button (click)="submitReport()">Submit</button>
        <button (click)="cancelReport()">Cancel</button>
      </div>
    </div>
  </div>

  <div class="report-wizard-popup" *ngIf="showReportWizard && !showReportContainer">
    <div class="popup-content">
      <h2>Open Existing Report</h2>
      <!-- Search Section -->
  <div class="search-container">
    <input type="text" placeholder="Search reports" [(ngModel)]="searchTerm" (ngModelChange)="handleSearchChange()">
  </div>
      <!-- Search Results Section -->
  <div *ngIf="isSearching">
    <h3>Search Results</h3>
    <div *ngIf="searchResults && searchResults.length > 0">
      <div class="table-list">
        <div *ngFor="let report of searchResults">
          <div class="table-name-container">
            <h5>{{ report.title }}</h5>
            <!-- <button class="view-button" (click)="openPopup(report.title, report.reportID)">View</button> -->
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="searchResults && searchResults.length === 0">
      <p>No reports found.</p>
    </div>
  </div>

  <div *ngIf="!isSearching">
    <label for="selectReportDropdown">Select Report:</label>
      <select id="selectReportDropdown" [(ngModel)]="selectedReportId">
        <option *ngFor="let report of reports" [value]="report.reportID">{{ report.title }}</option>
      </select>
      <button (click)="openSelectedReport()">Open Report</button>
  </div>

      <div class="button-container">
        <button (click)="submitReport()">Open Report</button>
        <button (click)="cancelReport()">Cancel</button>
      </div>
    </div>
  </div>

  <div class="edit-container" #editableDiv>
    <div class="report-container" *ngIf="showReportContainer">
      <div class="top-section">
        <!-- Image and title -->
        <div class="image-and-title">
          <img *ngIf="reportDetails.logoImage" [src]="reportDetails.logoImage" alt="Report Logo" class="report-logo"/>
          <input *ngIf="!reportDetails.logoImage" type="file" id="reportLogo" (change)="onLogoSelected($event)" accept="image/*" /><br><br />
          <h1 (click)="toggleCellSelection(selectedReportId,0)" [ngClass]="{'selected-cell': isSelected(selectedReportId, 0)}" [ngStyle]="applyStyle(selectedReportId, 0)">{{reportTitle}}</h1>
        </div>
        <!-- Current date/time -->
        <div class="date-time">
          <p>{{ currentDate }}</p>
          <p>{{ currentTime }}</p>
        </div>
      </div>

      <div *ngIf="tableHeaders.length > 0">
        <div class="table-container">
          <!-- Include the table rendering code here -->
          <table class="tbl-data">
            <thead>
              <tr>
                <th></th>
                <th *ngFor="let header of tableHeaders; let i = index" (click)="toggleCellSelection(i, 'column-header')">
                  <div class="column-header">{{ getColumnHeader(i) }}</div>
                </th>
              </tr>
              <tr>
                <th></th>
                <!-- Include table headers here -->
                <th *ngFor="let header of tableHeaders; let z = index" (click)="toggleCellSelection(header.reportID, header.dataID)" [ngClass]="{'selected-cell': isSelected(header.reportID, header.dataID)}" [ngStyle]="applyStyle(header.reportID, header.dataID)">
                  <div class="table-header">{{ header.cellValue }}</div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let rowData of tableData; let i = index">
                <script>console.log(rowData);</script>
                <td class="row-header" (click)="toggleCellSelection(i, 'row-header')">
                  {{ i + 1 }}
                </td>
                <!-- Include table cells here -->
                <td *ngFor="let cell of rowData; let j = index" class="cell-content" (click)="toggleCellSelection(cell.reportID, cell.dataID)" [ngClass]="{'selected-cell': isSelected(cell.reportID, cell.dataID)}" [ngStyle]="applyStyle(cell.reportID, cell.dataID)" [attr.data-row]="i" [attr.data-col]="j">
                  {{ cell.cellValue }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
